<!DOCTYPE html>
<html dir="ltr">

<head>
  <meta charset="UTF-8">
  <title>Drawer - Standalone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <link href="../../../../../css/core.css" rel="stylesheet">
  <link href="../../../../../scripts/testing/styles.css" rel="stylesheet">
  <script src="../../../../../scripts/testing/scripts.js"></script>
  <script nomodule src="../../../../../dist/ionic/ionic.js"></script>
  <script type="module" src="../../../../../dist/ionic/ionic.esm.js"></script></head>

<body class="ion-padding">
  <div id="parallax" class="parallax">
  </div>
  <ion-drawer id="drawer" snap-offsets="200,300" preview-offset="100" can-close="false">
  </ion-drawer>

  <style>
    .parallax {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: 200%;
      background-position: 20% 0;
      z-index: 1;

      transform: translate3d(0, 0, 0);
              
      background-image: url('parallax/img.jpg');
    }
  </style>

  <script>
    function showDrawer(where) {
      const drawer = document.querySelector('ion-drawer');
      drawer.snapTo = where;
    }

    function closeDrawer() {
      const drawer = document.querySelector('ion-drawer');
      console.log('Closing drawer');
      drawer.snapTo = null;
    }

    function openDrawer() {
      const drawer = document.querySelector('ion-drawer');
      console.log('Closing drawer');
      drawer.snapTo = -1;
    }

    const drawer = document.querySelector('#drawer');
    drawer.addEventListener('ionDrawerWillClose', async (e) => {
      console.log('Drawer closed!', e);
      drawer.snapTo = null;
      animateParallax(false, e.detail.y);
    });
    drawer.addEventListener('ionDrawerWillOpen', async (e) => {
      console.log('Drawer open', e);
      animateParallax(true, e.detail.y);
    });

    const bgRef = document.querySelector('#parallax');

    let startingY;

    function disableParallaxAnimation() {
      bgRef.style.transition = '';
    }

    function animateParallax (expanded, finalY) {
      console.log('Animate parallax', expanded, finalY);

      if (!bgRef) {
        return;
      }

      bgRef.style.transition = '100ms transform ease-in-out';

      const diff = startingY - finalY;
      const offset = -diff * 0.2;

      window.requestAnimationFrame(() => {
        bgRef.style.transform = `translate3d(0, ${offset}px, 0)`;
      });
    }

    drawer.addEventListener('ionDrawerPositionChange', (e) => {
      console.log('Drawer change', e.detail);


          // If we don't have a starting y, then store it and use it to compute the
      // absolute delta from the starting position, so we can compute the parallax amount
      if (!startingY) {
        startingY = e.detail.y;
      }

      if (e.detail.isSnap) {
        animateParallax(true, e.detail.y);
      } else {
        // Turn off any CSS animation for the image we will apply a parallax effect to
        disableParallaxAnimation();
      }

      const diff = startingY - e.detail.y;

      console.log('DIFF', diff);

      window.requestAnimationFrame(() => {
        if (diff <= 0) {
          // We are bottomed out, so should rubber band the image
          const scale = 1 + -diff * 0.00025;
          bgRef.style.transform = `translate3d(0, 0, 0) scale(${scale})`;
        } else {
          // If the diff is > zero, that means
          // we are not bottomed-out and should just slide the image up
          const y = -diff * 0.2;
          bgRef.style.transform = `translate3d(0, ${y}px, 0)`;
        }
      });
    })

    drawer.innerHTML = `
    <ion-content>
      <ion-list>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="person" />
          </ion-avatar>
          <ion-label>
            Are you here now?
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="share" />
          </ion-avatar>
          <ion-label>
            Share with a friend
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="planet" />
          </ion-avatar>
          <ion-label>
            mars.nasa.gov
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
        <ion-item detail>
          <ion-avatar slot="start">
            <ion-icon name="md-create" />
          </ion-avatar>
          <ion-label>
            Suggest an edit
          </ion-label>
        </ion-item>
      </ion-list>
      <!--
      <div class="info">
        <h3>Description</h3>
        <p>
          Mars is the fourth planet from the Sun and the second-smallest planet in the Solar System after Mercury. In English, Mars carries a name of the Roman god of war, and is often referred to as the "Red Planet"[15][16] because the iron oxide prevalent on its surface gives it a reddish appearance that is distinctive among the astronomical bodies visible to the naked eye.[17] Mars is a terrestrial planet with a thin atmosphere, having surface features reminiscent both of the impact craters of the Moon and the valleys, deserts, and polar ice caps of Earth.
        </p>
      </div>
      -->
    </ion-content>
    `;
  </script>
</body>
</html>
