<html ng-app="ionic.example">
  <head>
    <meta charset="utf-8">
    <title>Weather</title>

    <!-- Sets initial viewport load and disables zooming  -->
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="stylesheet" href="/dist/css/ionic.css">

    <link rel="stylesheet" href="weather.css">

    <script src="/vendor/angular/angular-1.2.0rc2.min.js"></script>
    <script src="/vendor/angular/angular-touch.js"></script>
    <script src="/vendor/angular/angular-animate.js"></script>
    <script src="/dist/js/ionic.js"></script>
    <script src="/dist/js/ionic-angular.js"></script>
  </head>
  <body ng-controller="WeatherCtrl">
    <header id="header" class="bar bar-header bar-clear">
      <button class="button button-icon"><i class="icon-navicon-round"></i></button>
      <h1 class="title">
        <span class="city">{{current.city.name}}</span><br>
        <current-time></current-time>
      </h1>
    </header>
    <content id="main-content" has-header="true" padded="true">
      <small-weather>
        <h5>{{current.cover}}</h5>
        <h5>H: {{current.high}} L: {{current.low}}</h5>
        <h1 class="current-temp">{{current.temp}}&deg;</h1>
      </small-weather>
      <weather-box title="Forecast" style="height: 400px">
      </weather-box>
      <weather-box title="Details" style="height: 400px">
      </weather-box>
    </content>
  </body>

  <script>
    angular.module('ionic.example', ['ionic.ui.content'])

    .directive('currentTime', function($timeout, $filter) {
      return {
        restrict: 'E',
        replace: true,
        template: '<span class="current-time">{{currentTime}}</span>',
        link: function($scope, $element, $attr) {
          $timeout(function checkTime() {
            $scope.currentTime = $filter('date')(new Date, 'H:mm');
            $timeout(checkTime, 500);
          });
        }
      }
     })

    .directive('smallWeather', function($timeout) {
      return {
        restrict: 'E',
        replace: true,
        transclude: true,
        template: '<div id="small-weather" ng-transclude></div>',
        link: function($scope, $element, $attr) {

          // Delay so we are in the DOM and can calculate sizes
          $timeout(function() {
            var windowHeight = window.innerHeight;
            var thisHeight = $element[0].offsetHeight;
            var headerHeight = document.querySelector('#header').offsetHeight;
            $element[0].style.marginTop = (windowHeight - thisHeight) + 'px';
            angular.element(document.querySelector('.content')).css('-webkit-overflow-scrolling', 'auto');
            $timeout(function() {
              angular.element(document.querySelector('.content')).css('-webkit-overflow-scrolling', 'touch');
            }, 50);
          });
        }
      }
    })

    .directive('weatherBox', function($timeout) {
      return {
        restrict: 'E',
        replace: true,
        transclude: true,
        scope: {
          title: '@'
        },
        template: '<div class="weather-box"><h4 class="title">{{title}}</h4><div ng-transclude></div></div>',
        link: function($scope, $element, $attr) {
        }
      }
    })
    

    .filter('temp', function() {
      return function(v) {
        return v + '&deg;';
      };
    })

    .controller('WeatherCtrl', function($scope) {
      $scope.current = {
        city: {
          name: 'Madison'
        },
        temp: 36,
        cover: 'Partly cloudy',
        high: 43,
        low: 27
      }
    });
  </script>
</html>
